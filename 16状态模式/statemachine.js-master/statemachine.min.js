(function(p){var K=p.StateMachine,b={__version__:"0.1.2",__license__:"MIT",__author__:"Ye Liu",__contact__:"yeliu@instast.com",__copyright__:"Copyright (c) 2015 Ye Liu",noConflict:function(){p.StateMachine=K;return this},init:function(b,g,h,a){var c;switch(arguments.length){case 0:b={};g=[];break;case 1:b=b||{};case 2:g=f(g||b.states)}c=x(b,g);c.callEntryIfTransitBack=r(h)?h:!0;c.callExitIfTransitBack=r(a)?a:!0;b.fsm=c;b.handleStateTrigger=y(c);b.getCurrentStateName=function(){return c.currentState?
c.currentState.name:null};b.getPreviousStateName=function(){return c.previousState?c.previousState.name:null};0<g.length&&(c.currentState=t(c,g[0].name),u(c));return b}},x=function(b,g){var h={host:b,statesMap:{},currentState:null,currentStateStack:[]};g=f(g);for(var a=0,c=g.length;a<c;a++)z(h.statesMap,g[a]);return h},z=function g(b,a,c){m(a)?a={name:a}:a||(a={});m(a.name)||(a.name="UnnamedState");var d={name:a.name,fqn:a.name,entry:a.entry,exit:a.exit,transitions:[],outerState:null,innerStates:[]};
c&&(d.fqn=c.fqn+"."+d.name,d.outerState=c);b[d.fqn]=d;a.transitions=f(a.transitions);for(var e=0,l=a.transitions.length;e<l;e++)c=a.transitions[e],d.transitions[e]={trigger:c.trigger,dest:c.dest,action:c.action,guard:c.guard};a.innerStates=f(a.innerStates);e=0;for(l=a.innerStates.length;e<l;e++)d.innerStates[e]=g(b,a.innerStates[e],d);return d},y=function(b){var h=b.host;return function(a,c,d){var e=b.currentState;a=A(e,a);for(var l,f,k=0,m=a.length;k<m;k++)if(l=a[k],!1!==n(l.guard,h,d)&&(f=t(b,l.dest))){n(l.action,
h,c);(f!==e&&f.outerState!==e||f===e&&b.callExitIfTransitBack)&&B(b,e,f);(function L(a,c){C(b,a,c);(c!==a||b.callEntryIfTransitBack)&&u(b);0<c.innerStates.length&&L(c,c.innerStates[0])})(e,f);break}}},A=function(b,h){var a=[],c;if(b)for(var d=0,e=b.transitions.length;d<e;d++)c=b.transitions[d],c.trigger===h&&a.push(c);return a},t=function h(a,b){var d,e=a.currentState?a.currentState.outerState:null;e?(d=a.statesMap[e.fqn+"."+b],d||(D(a,e),d=h(a,b),E(a))):d=a.statesMap[b];return d},D=function(b,a){b.currentStateStack.push(b.currentState);
b.currentState=a},E=function(b){b.currentState=b.currentStateStack.pop()},C=function(b,a,c){b.previousState=a;b.currentState=c},u=function(b){var a=b.host;if(b=b.currentState)n(b.entry,a),a.handleStateTrigger(".")},B=function a(b,d,e){var f=d.outerState;n(d.exit,b.host);f&&f!==e&&f!==e.outerState&&a(b,d.outerState,e)},v=function(a){return void 0!==a&&null!==a&&"[object Object]"===k.call(a)},q=function(a){return"[object Function]"===k.call(a)},m=function(a){return"[object String]"===k.call(a)},F=function(a){return"[object Number]"===
k.call(a)},r=function(a){return"[object Boolean]"===k.call(a)},G=Array.isArray||function(a){return"[object Array]"===k.call(a)},H=function(a){return F(a.length)&&!v(a)&&!m(a)&&!q(a)},f=function(a){return void 0===a||null===a?[]:G(a)?a:H(a)?Array.prototype.slice.call(a,0):[a]},J=function(a,b){return q(a)?a:m(a)&&v(b)&&q(b[a])?b[a]:I},n=function(a,b,d){return J(a,b).apply(b,f(d))},k=Object.prototype.toString,I=function(){};p.STATEMACHINE_EXPORT_EXTRA&&(b.isObject=v,b.isFunction=q,b.isString=m,b.isNumber=
F,b.isBoolean=r,b.isArray=G,b.isArrayLike=H,b.arrayFrom=f,b.functionFrom=J,b.functionApply=n,b.nop=I,b.initFsm=x,b.initState=z,b.handleStateTriggerFactory=y,b.getTransitions=A,b.getState=t,b.pushCurrentState=D,b.popCurrentState=E,b.changeState=C,b.doEntryAction=u,b.doExitAction=B);if("undefined"!==typeof module)for(var w in b)b.hasOwnProperty(w)&&(exports[w]=b[w]);else"undefined"!==typeof define?define(b):p.StateMachine=b})(this);
